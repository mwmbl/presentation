<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Mwmbl, the Free Search Engine - a Technical Introduction</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/black.css">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css">
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
	<!-- <section>Slide 1</section> -->
	<!-- <section>Slide 2</section> -->
	<section>
	  <h1>The challenges of building a non-profit search engine</h1>
<br>

<h3>Daoud Clarke</h3>

<br>
PyData Cardiff - 20th February 2023
	</section>
	<section>
	  <h3>Why do I have to see ads?</h3>
	  <img src="img/ads.png">
	</section>
	<section>
	  <h3>Why do I have to see a search results page?</h3>
	  <img src="img/obs.png">
	</section>
	<section>
	  <pre><code data-trim data-noescape class="stretch">
SEARCH_URL = 'https://www.google.com/search'
AGENT = 'Mozilla/5.0'


def perform_search(query):
    response = requests.get(
        SEARCH_URL,
        params={'q': query, 'client': AGENT})

    urls, titles = process_search_results(response.content)
    return urls, titles


def process_search_results(html_content):
    soup = BeautifulSoup(html_content, features="html.parser")
    headlines = soup.select('h3')
    urls = []
    for headline in headlines:
        link = headline.parent
        url = link.get('href')
        urls.append(url)
    titles = [span.get_text() for span in headlines]
    assert len(urls) == len(titles)
    return urls, titles
	  </code></pre>
	</section>
	<section>
	  <pre><code data-trim data-noescape class="stretch">
COMPLETE_URL = \
    'http://suggestqueries.google.com/complete/search'


app = FastAPI()


@app.get("/complete")
def complete(q: str):
    response = requests.get(
        COMPLETE_URL,
        params={'q': q, 'client': 'firefox'})
    completions = response.json()[1]
    all_urls, all_titles = perform_search(q)
    completion = completions[0]
    urls, titles = perform_search(completion)
    all_urls += urls
    all_titles += titles
    return [q, all_titles]
	  </code></pre>
	</section>
	<section>
	  <h3>Why is it so slow?</h3>
	</section>
	<section>
	  <h3>Attempt 1: SQLite</h3>
	</section>
	<section>
	  <pre><code data-trim data-noescape class="stretch">
@app.get("/complete")
def complete(q: str):
    terms = [x.lower() for x in q.split()]

    completed = complete_term(terms[-1])
    terms = terms[:-1] + [completed]

    con = sqlite3.connect(INDEX_PATH)
    in_part = ','.join('?'*len(terms))
    query = f"""
        SELECT title, url
        FROM terms INNER JOIN pages
        ON terms.page_id = pages.id
        WHERE term IN ({in_part})
        GROUP BY title, url
        ORDER BY count(*) DESC, length(title)
        LIMIT 5
    """

    data = con.execute(query, terms).fetchall()

    results = [title.replace("\n", "") + ' â€” ' +
               url.replace("\n", "") for title, url in data]
    if len(results) == 0:
        return []
    return [q, results]
	  </code></pre>
	</section>

	<section>
	  <img class="stretch" src="img/latency-1.png">
	</section>
	<section>
	  <img class="stretch" src="img/latency-2.png">
	</section>
	<section>
	  <img class="stretch" src="img/latency-3.png">
	</section>
	<section>
	  <img class="stretch" src="img/latency-4.png">
	</section>
	  
	</section>
	<section data-background-image="img/larry-page.png">
	  <h3>Why should the gateway to the world's knowledge be in the hands of a corporation?</h3>
	</section>
	
	<section data-markdown data-separator="^\n\n">
	  <textarea data-template>
	    
# The challenges of building a non-profit search engine
<br>

### Daoud Clarke

<br>
PyData Cardiff - 20th February 2023


### Why should the gateway to the world's knowledge be in the hands of a corporation?


# Introduction
 - Brief overview of the challenges of building a non-profit search engine
 - Introduction to MWMBL, an open-source, non-profit search engine built from scratch
 - Overview of the talk's content and its objectives


### Designing an Efficient Search Engine Index
 -   Explanation of the specially designed index based on pages of memory
 -   Discussion of the benefits of storing search results in compressed pages of 4096 bytes
 -   Overview of how the search engine is effectively one large hash map built around these compressed pages
 -   Discussion of how cost-effectiveness is achieved through reduced storage space requirements
 -   Explanation of other tricks used, such as discarding unnecessary data and only storing the most important search results
 -   Discussion of how this allows the storage of billions of search results on a single machine


# Designing a Distributed Crawler

 -  Explanation of how the crawler is distributed via a Firefox extension run by volunteers
 -  Discussion of how the crawler retrieves a set of URLs to crawl from a central server
 -  Overview of the process of retrieving and processing the URLs
 -  Explanation of how the results are batched up and sent back to the central server
 -  Discussion of the benefits of a distributed crawling approach


# Starting an Open Source Project and Community

 - Discussion of what it's like starting an open source project from scratch
 - Explanation of the challenges and benefits of building a community around the project
 - Overview of the importance of collaboration and community in open source projects
 - Discussion of how the success of MWMBL is driven by the community of volunteers and contributors


# Conclusion

 - Summary of the technical design of the index and crawler
 - Discussion of the achievements and challenges of building a non-profit search engine
 - Final thoughts on the future of MWMBL and the impact it will have
 - Q&A session for audience members to ask questions.
	  </textarea>
	</section>
      </div>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script>
      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
	  hash: true,

	  // Learn about plugins: https://revealjs.com/plugins/
	  plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
      });
    </script>
  </body>
</html>
